## 판다스 자료구조

## 목적

분석을 위해 다양한 소스(Source)로부터 수집하는 데이터는 형태나 속성이 매우 다양하다.

특히, 서로 다른 형식을 갖는 여러 종류의 데이터를 컴퓨터가 이해할 수 있도록 동일한 형식을 갖는 구조로 통합할 필요가 있다.

판다스의 일차적인 목적은 형식적으로 서로 다른 여러 가지 유형의 데이터를 공통의 포맷으로 정리하는 것이다.

## 종류

판다스는 시리즈(Series)와 데이터프레임(Dataframe)이라는 구조화된 데이터 형식을 제공한다.

서로 다른 종류의 데이터를 한곳에 담는 그릇(컨테이너)이 된다.

다만, 시리즈는 1차원 배열이고, 데이터프레임이 2차원 배열이라는 점에서 차이가 있다.

특히 형과 열로 이루어진 2차원 구조의 데이터프레임은 데이터 분석 실무에서 자주 사용된다.

## 시리즈

데이터가 순차적으로 나열된 1차원 배열의 형태

인덱스와 데이터 값과 일대일 대응

키와 값이 ‘{k:v}’ 형태로 짝을 이루는 파이썬 딕셔너리와 비슷한 구조

따라서 딕셔너리를 시리즈로 변환하는 방법을 많이 사용


```python
!pip install pandas
import pandas as pd


dict_data = {'a':1, 'b':2,'c':3}


sr = pd.Series(dict_data)


print(type(sr))


print(sr)


# <class 'pandas.core.series.Series'>
# a    1
# b    2
# c    3
# dtype: int64
```

## 인덱스의 구조

인덱스는 자기와 짝을 이루는 데이터 값의 순서와 주소를 저장

인덱스를 활용하여 데이터 값의 탐색, 정렬, 선택, 결합 등 데이터 조작을 쉽게 가능

시리즈 클래스의 index 속성을 이용하여 인덱스 배열을 따로 선택 가능

데이터 값 배열만을 따로 선택할 수도 있으며 시리즈 클래스의 values 속성을 이용

## 시리즈 변환

판다스 Series() 함수를 사용하여 파이썬 리스트를 시리즈로 변환

단, 리스트를 시리즈로 변환할 때는 딕셔너리의 키처럼 인덱스로 변환될 값이 없음

따라서 인덱스를 별도로 정의하지 않으면 디폴트로 정수형 위치 인덱스가 자동으로 지정

```python
import pandas as pd
# 리스트를 시리즈로 변환하여 변수 sr에 저장
list_data = ['2019-01-02', 3.14, 'ABC', 100, True]
sr = pd.Series(list_data)
print(sr)


# 0    2019-01-02
# 1          3.14
# 2           ABC
# 3           100
# 4          True
# dtype: object


# 인덱스 배열은 변수 idx에 저장
idx = sr.index
print(idx)
# RangeIndex(start=0, stop=5, step=1)


# 데이터 값 배열은 변수 val에 저장
val = sr.values
print(val)
# RangeIndex(start=0, stop=5, step=1)


# 시리즈 배열을 구성하는 원소의 자료형
print(sr.dtype)
# object


#시리즈 배열의 크기
print(len(sr))
# 5


# 시리즈 배열의 형태
print(sr.shape)
# (5,)


# 시지르 배열의 차원
print(sr.ndim)
# 1

```

value_counts()를 통해서 리스트 value 값들의 개수를 측정 가능

```python
import random
rd_lists = [random.randint(1,10) for i in range(20)]
pd.Series(rd_lists).value_counts()

```

## 원소 선택

원소의 위치를 나타내는 주소 역할을 하는 인덱스를 이용하여 시리즈의 원소를 선택 (하나 또는 여러 개 선택 가능)

파이썬 리스트 슬라이싱(slicing) 기법과 비슷하게 인덱스 범위를 지정하여 원소를 선택하는 방법도 있음

정수형 위치 인덱스는 대괄호 안에 위치를 나타내는 숫자를 입력

인덱스 이름(라벨)을 사용할 때는 대괄호 안에 이름과 함께 따옴표를 입력

Series() 함수를 사용하여 파이썬 투플(tuple)을 시리즈로 변환

투플도 리스트처럼 딕셔너리의 키에 해당하는 값이 없어서 시리즈로 변환할 때 정수형 위치 인덱스가 자동으로 지정

리스트 또는 투플을 시리즈로 만들 때 정수형 위치 인덱스 대신 인덱스 이름을 따로 지정 가능

Series() 함수의 index 옵션에 인덱스 이름을 직접 전달하는 방식

## 데이터 프레임

데이터 프레임은 2차원 배열

데이터프레임의 열은 시리즈 객체.

시리즈를 열벡터라고 하면 데이터 프레임은 여러 개의 열벡터들이 같은 행 인덱스를 기준으로 줄지어 결합된 2차원 벡터 또는 행렬

데이터터프레임은 행과 열을 나타내기 위해 두 가지 종류의 주소를 사용, 행 인덱스와 열 이름으로 구분

데이터 프레임의 각 열은 공통의 속성이나 범주를 나타내는데 보통 변수로 활용

```python
# 데이터 프레임 만들기
import pandas as pd
li = []
values= []
keys = ['c' + str(i) for i in range(5)]
for i in range(1,16):
    li.append(i)
    if i %3 == 0:
        values.append(li)
        li = []


df = pd.DataFrame(dict(zip(keys, values)))
print(df)
type(df)


#    c0  c1  c2  c3  c4
# 0   1   4   7  10  13
# 1   2   5   8  11  14
# 2   3   6   9  12  15


# pandas.core.frame.DataFrame

```

딕셔너리(키 벨류) 형태면 시리즈 형태(세로, 기둥형태)

가로로 데이터를 넣을 경우 리스트 형태


### 행 인덱스/열 이름 설정

데이터프레임의 구조적 특성 때문에 2차원 배열 형태의 데이터를 데이터프레임으로 변환하기 쉬움

2차원 배열에는 여러 개의 리스트(투플)을 원소로 갖는 리스트(투플), numpy 배열 등이 있음음

```python
# 딕셔너리       -> 데이터 프레임 : 시리즈의 합, 즉 데이터가 세로로 들어간다, 컬럼명은 키값
# 이차원 리스트  -> 데이터 프레임: 리스트 하나가 가로데이터, 컬럼명은 따로 지정하지 않으면 0부터 순차적


import pandas as pd
# 행 인덱스/열 이름 지정하여, 데이터프레임 만들기
df = pd.DataFrame([[15, '남', '덕영중'], [17, '여', '수리중']])
#     0  1    2
# 0  15  남  덕영중
# 1  17  여  수리중


df = pd.DataFrame([[15, '남', '덕영중'], [17, '여', '수리중']],
                  index= ['준서', '예은'],
                  columns= ['나이', '성별', '학교'])


print(df)


#     나이 성별   학교
# 준서  15  남  덕영중
# 예은  17  여  수리중


# 특정 컬럼의 이름을 변경할 경우
df.rename(columns={
    '나이' : '나나이'


}, index= {'준서':'준호'},
inplace=True)
# 결과를 바꾼 것일뿐 df가 바뀐 것은 아니다. -> inplace를 사용하면 내부 또한 바뀌게 된다.
# 주로 새롭게 지정하여 저장한다 ex) df2 = ~~
df



````

### 행/열 삭제

drop() 메소드로 행 또는 열을 삭제

행을 삭제 axis = 0 또는 axis=”index”를 입력하거나 별도로 입력하지 않음

열을 삭제 axis = 1 또는 axis =”columns”을 입력

drop() 메소드는 기존 객체를 변경하지 않고 새로운 객체를 반환


### 행 선택

loc와 iloc 인덱서를 사용해 행 데이터를 선택

행을 선택할 때는 loc, 정수형 위치 인덱스를 사용할 때는 iloc

``` python
# 데이터프레임에서 ['키'] -> 컬럼정보를 추출
# 행렬 형태로 출력하려면 loc or iloc
print(df.loc[[0]])
# [] : 시리즈 , [[]] : 데이터프레임
print()
print(df.iloc[[1]])


#    c0  c1  c2  c3  c4
# 0   1   4   7  10  13


#    c0  c1  c2  c3  c4
# 1   2   5   8  11  14
```

### 행, 열의 위치 바꾸기

데이터프레임의 행과 열을 사로 맞바꾸는 방법

전치행렬과 같은 개념

df.transpose

df.T

## 인덱스 활용

### 특정 열을 행 인덱스로 설정

set_index() 메소드를 사용하여 데이터프레임의 특정 열을 행 인덱스로 설정

기존의 데이터가 없어지는 것을 유의해야 함

### 행 인덱스 재배열

reindex() 메서드를 사용하면 데이터프레임의 행 인덱스를 새로운 배열로 재지정 가능

기존 객체를 변경하지 않고 새로운 데이터프레임 객체를 반환

데이터가 존재하지 않는 경우 fill_value 옵션에 원하는 값을 입력해 지정 가능

### 행 인덱스 초기화

reset_index() 메서드를 활용하여 행 인덱스를 정수형 위치 인덱스로 초기화

기존행 인덱스는 열로 이동 -> 새로운 데이터프레임 객체를 반환

----

# 산술연산

## 시리즈 연산

### 시리즈 vs 숫자

시리즈 객체에 어떤 숫자를 더하면 시리즈의 개별 원소에 각각 숫자를 더하고 계산한 결과를 시리즈 객체로 반환

덧셈, 뺄셈, 곱셈, 나눗셈 모두 가능

### 시리즈 vs 시리즈

시리즈와 시리즈 사이의 사칙연산을 처리하는 방법

시리즈의 모든 인덱스에 대하여 같은 인덱스를 가진 원소끼리 계산하고 연산 결과를 매칭하여 새 시리즈를 반환

연산을 하는 두 시리즈의 원소 개수가 다르거나, 시리즈의 크기가 같더라도 인덱스 값이 다를 수 있음

어느 한쪽에만 인덱스가 존재하고 다른 쪽에는 짝을 지을 수 있는 동일한 인덱스가 없는 경우 정상적으로 연산을 처리할 수 없음

이럴때 판다스는 유효한 값이 존재하지 않는다는 의미를 갖는 NaN으로 처리하며 연산의 결과 또한 NaN으로 입력됨

한편 동일한 인덱스가 양쪽에 모두 존재하여 서로 대응되더라도 어느 한 쪽의 데이터 값이 NaN인 경우 결과는 NaN

### 연산 메소드

연산에서 객체 사이에 공통 인덱스가 없는 경우 연산 결과는 NaN으로 반환

이런 상황을 피하려면 연산 메소드에 fill_values 옵션을 설정하여 적용

## 데이터프레임 연산

데이터 프레임 - 여러 시리즈가 한데 모인 것, 시리즈 연산을 확장하는 개념으로 이해하는 것이 좋음

### 데이터프레임 vs 숫자

데이터프레임에 어떤 숫자를 더하면 모든 원소에 숫자를 더하며 덧셈, 뺄셈, 곱셈, 나눗셈 모두 가능

기존 데이터프레임의 형태를 그대로 유지한 채 원소 값만 새로운 계산 값으로 바뀜.

새로운 데이터프레임 객체로 반환되는 점에 유의

### 데이터프레임 vs 데이터프레임

각 데이터프레임의 같은 행, 같은 열 위치에 있는 원소끼리 계산

이처럼 동일한 위치의 원소끼리 계산한 결과값을 원래 위치에 다시 입력하여 데이터프레임을 생성

데이터프레임 중에서 어느 한쪽에 원소가 존재하지 않거나 NaN이면 연산 결과는 NaN으로 처리

연산 메소드 사용 가능

객체 사이에 공통 인덱스가 없거나 누락 데이터가 있는 경우 NaN으로 반환되는데, 연산 메소드에 fill_value 옵션을 설정하여 누락 데이터를 대체 가능

-----

# 필터링

시리즈 또는 데이터프레임의 데이터 중에서 특정 조건식을 만족하는 원소만 따로 추출하는 개념

가장 대표적인 방법 : 불린 인덱싱

## 불린 인덱싱

시리즈 객체에 어떤 조건식을 적용하면 각 원소에 대해 참/거짓을 판별하여 불린(참,거짓) 값으로 구성된 시리즈를 반환

이때 참에 해당하는 데이터 값을 따로 선택할 수 있는데, 많은 데이터 중에서 어떤 조건을 만족하는 데이터만을 추출하는 필터링 기법의 한 유형

데이터프레임의 각 열은 시리즈 객체이므로, 비교연산자(>,<, ==, !=) 또는 논리연산자(&, |, ~)등을 사용하여 조건식을 적용하면 각 원소가 조건을 만족하는지 여부를 참과 거짓 값으로 하여 불린 시리즈를 만들 수 있음

불린 시리즈를 데이터프레임에 대입하면 조건을 만족하는 행들만 선택할 수 있음

## query() 메소드 활용

query() 메소드를 적용하면 문자열 표현을 사용해 간편하게 필터링 수행 가능

조건을 구성하는 문자열 내에서 열 이름은 변수처럼 직접 사용할 수 있으며, 조건은 파이썬의 표준 비교 연산자(==, !=, >, <, >=, <=)와 논리 연산자(and, or, not)을 사용하여 표현

## isin() 메소드 활용

열에 isin() 메소드를 적용하면 특정 값을 가진 행들을 따로 추출 가능

isin() 메소드에 데이터프레임의 열에서 추출하려는 값들로 만든 리스트를 전달

----

# 텍스트 처리

## 텍스트 저장

텍스트 데이터를 저장하는 두 가지 주요 방법

object 자료형과 확장 타입인 StringDtype(string 자료형)

## 문자열 메소드(String methods)

1차원 배열 객체인 시리즈와 인덱스는 각 요소에 대해 작업을 쉽게 수행할 수 있는 문자열 처리 메소드 제공

str 속성을 통해 접근가능

대부분의 메소드는 파이썬 내장 문자열 메소드와 이름이 같음
